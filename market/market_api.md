# 市场数据分析 API 文档

## 重要说明

1. 实现不影响现有的采集器和管理后台功能
2. 所有相关代码和文件都位于 `market` 目录下

```

## 基础信息

- 基础路径: `/api/v1/market`
- 返回格式: JSON
- 编码方式: UTF-8

## 通用参数说明

### 服务器类型 (server_type)
- 0: 商业大亨
- 1: 企业家

### 商品类型 (product_type)

#### 能源行业
| ID | 名称 |
|----|------|
| 1 | 电力 |
| 10 | 原油 |
| 11 | 汽油 |
| 12 | 柴油 |
| 73 | 乙醇 |
| 74 | 甲烷 |
| 83 | 火箭燃料 |

#### 农业
| ID | 名称 |
|----|------|
| 66 | 种子 |
| 3 | 苹果 |
| 4 | 橘子 |
| 5 | 葡萄 |
| 6 | 谷物 |
| 72 | 甘蔗 |
| 40 | 棉花 |
| 115 | 牛 |
| 116 | 猪 |
| 118 | 咖啡豆 |
| 136 | 可可 |
| 120 | 蔬菜 |
| 139 | 动物饲料 |

#### 食品加工业
| ID | 名称 |
|----|------|
| 137 | 面团 |
| 138 | 酱汁 |
| 7 | 牛排 |
| 8 | 香肠 |
| 9 | 鸡蛋 |
| 117 | 牛奶 |
| 119 | 咖啡粉 |
| 133 | 面粉 |
| 121 | 面包 |
| 123 | 苹果派 |
| 124 | 橙汁 |
| 125 | 苹果汁 |
| 126 | 姜汁汽水 |
| 127 | 披萨 |
| 128 | 面条 |
| 134 | 黄油 |
| 122 | 芝士 |
| 140 | 巧克力 |
| 135 | 糖 |
| 129 | 汉堡包 |
| 130 | 千层面 |
| 131 | 肉丸 |
| 132 | 混合果汁 |
| 141 | 植物油 |
| 142 | 沙拉 |
| 143 | 咖喱角 |
| 149 | 南瓜汤 |

#### 建筑
| ID | 名称 |
|----|------|
| 106 | 木材 |
| 101 | 钢筋混凝土 |
| 102 | 砖块 |
| 103 | 水泥 |
| 104 | 黏土 |
| 105 | 石灰石 |
| 107 | 钢筋 |
| 108 | 木板 |
| 109 | 窗户 |
| 110 | 工具 |
| 111 | 建筑预构件 |

#### 时装业
| ID | 名称 |
|----|------|
| 41 | 棉布 |
| 46 | 皮革 |
| 60 | 内衣 |
| 61 | 手套 |
| 62 | 裙子 |
| 63 | 高跟鞋 |
| 64 | 手袋 |
| 65 | 运动鞋 |
| 70 | 名牌手表 |
| 71 | 项链 |

#### 电子产品制造业
| ID | 名称 |
|----|------|
| 20 | 处理器 |
| 21 | 电子元件 |
| 22 | 电池 |
| 23 | 显示屏 |
| 24 | 智能手机 |
| 25 | 平板电脑 |
| 26 | 笔记本电脑 |
| 27 | 显示器 |
| 28 | 电视机 |
| 79 | 精密电子元件 |
| 98 | 无人机 |
| 114 | 机器人 |

#### 航空航天制造业
| ID | 名称 |
|----|------|
| 77 | 机身 |
| 78 | 机翼 |
| 80 | 飞行计算机 |
| 81 | 座舱 |
| 82 | 姿态控制器 |
| 84 | 燃料储罐 |
| 85 | 固体燃料助推器 |
| 86 | 火箭发动机 |
| 87 | 隔热板 |
| 88 | 离子推进器 |
| 89 | 喷气发动机 |

#### 原材料加工业
| ID | 名称 |
|----|------|
| 2 | 水 |
| 13 | 运输单位 |
| 14 | 矿物 |
| 15 | 铝土矿 |
| 16 | 硅材 |
| 17 | 化合物 |
| 18 | 铝材 |
| 19 | 塑料 |
| 42 | 铁矿石 |
| 43 | 钢材 |
| 44 | 沙子 |
| 45 | 玻璃 |
| 68 | 金矿石 |
| 69 | 金条 |
| 75 | 碳纤维 |
| 76 | 碳纤复合材 |

#### 科研行业
| ID | 名称 |
|----|------|
| 29 | 作物研究 |
| 30 | 能源研究 |
| 31 | 采矿研究 |
| 32 | 电器研究 |
| 33 | 畜牧研究 |
| 34 | 化学研究 |
| 35 | 软件 |
| 58 | 汽车研究 |
| 59 | 时装研究 |
| 100 | 航空航天研究 |
| 113 | 材料研究 |
| 145 | 食谱 |

#### 季节性
| ID | 名称 |
|----|------|
| 146 | 南瓜 |
| 67 | 圣诞爆竹 |
| 144 | 圣诞装饰品 |
| 147 | 杰克灯笼 |
| 148 | 女巫服 |
| 150 | 树 |

### 商品分组 (group_name)
- 能源行业
- 农业
- 食品
- 建筑
- 时装业
- 电子产品
- 航空航天
- 原材料
- 科研
- 季节性

### 时间格式
- 所有时间参数使用 ISO 8601 格式
- 示例：`2024-01-12T10:00:00Z`

### 通用响应格式
```json
{
    "code": 0,           // 状态码，0表示成功
    "message": "success", // 状态信息
    "data": {            // 具体数据
        // 具体字段
    }
}
```

## 数据库表结构

### 市场数据表
表名格式：`market_{server_type}_{product_type}`
例如：`market_0_1` 表示商业大亨服务器的电力商品市场数据
例如：`market_1_1` 表示企业家服务器的电力商品市场数据

存储引擎：InnoDB
字符集：utf8mb4
排序规则：utf8mb4_general_ci
自增值：从1263开始

| 字段名 | 类型 | 空值 | 索引 | 默认值 | 说明 |
|--------|------|------|------|--------|------|
| id | bigint(20) | NO | PRI | NULL | 自增主键 |
| market_id | bigint(20) | NO | UNI | NULL | 市场订单ID |
| kind | int(11) | NO | - | NULL | 商品类型标识 |
| quantity | int(11) | NO | - | NULL | 数量 |
| quality | tinyint(4) | NO | - | NULL | 品质 |
| price | decimal(10,3) | NO | - | NULL | 价格 |
| seller_id | bigint(20) | NO | MUL | NULL | 卖家ID |
| seller_name | varchar(100) | NO | - | NULL | 卖家名称 |
| seller_realm_id | tinyint(4) | NO | - | NULL | 卖家服务器ID |
| seller_certificates | int(11) | YES | - | 0 | 卖家证书数 |
| seller_contest_wins | int(11) | YES | - | 0 | 卖家比赛获胜次数 |
| seller_is_npc | tinyint(1) | NO | - | 0 | 是否NPC |
| fees | int(11) | YES | - | 0 | 交易费用 |
| posted_time | datetime | NO | MUL | NULL | 发布时间 |
| batch_id | bigint(20) | NO | MUL | NULL | 采集批次号 |
| data_version | int(11) | NO | - | 1 | 数据版本号 |
| is_valid | tinyint(1) | NO | - | 1 | 数据是否有效 |
| data_source | varchar(50) | NO | - | 'api' | 数据来源 |
| created_at | datetime | NO | - | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | datetime | YES | - | NULL | 更新时间，自动更新 |

索引信息：
- PRIMARY KEY (id)：
  - 类型：BTREE
  - 唯一性：是
  - 作用：主键索引，自增长

- UNIQUE KEY uk_market_id (market_id)：
  - 类型：BTREE
  - 唯一性：是
  - 作用：确保市场订单ID唯一

- INDEX idx_seller_id (seller_id)：
  - 类型：BTREE
  - 基数：1258
  - 作用：优化卖家查询

- INDEX idx_posted_time (posted_time)：
  - 类型：BTREE
  - 基数：1258
  - 作用：优化时间查询

- INDEX idx_batch_id (batch_id)：
  - 类型：BTREE
  - 基数：96
  - 作用：优化批次查询

注意事项：
1. 表大小和性能：
   - 当前记录数：约1258条
   - 批次数：96个不同的batch_id
   - 建议定期清理过期数据

2. 字段特点：
   - 大部分字段不允许为NULL
   - 时间字段使用datetime类型
   - 布尔值使用tinyint(1)

3. 索引使用：
   - 主要查询应该围绕posted_time和seller_id
   - batch_id的基数较小，适合批量操作
